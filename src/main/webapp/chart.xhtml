<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"	
	xmlns:cc="http://xmlns.jcp.org/jsf/composite"
	xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	template="/template/dashboard-rov-layout.xhtml" >

	<f:metadata>
	
	<!-- Create Table Header -->
	<f:viewAction action="#{satReportsBean.CreateFields(8)}" />  
          
    </f:metadata>		

    <ui:define name="main-content" >   <!-- MAIN CONTENT TEMPLATE --> 
    
    		<h:outputStylesheet library="css/reports" name="reports_template.css" />
    
    <ui:define name="head" >    
    
     <title>Charts Test</title>
     
    </ui:define>    
       
    <h:outputScript name="google-charts-loader.js" library="js/plugins/google" />
    <script type="text/javascript">
              
        google.charts.load('current', {packages: ['line']}); 
        google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
    	  
    	let columns = #{chartBean.countriesString}; // Columns from backing bean JSF
    	    	    	      	
        var data = new google.visualization.DataTable();
        
        //Add columns
        for(c = 0; c &lt; columns.length; c++ )        
         data.addColumn('number', columns[c]);
            
         //Add rows
         data.addRows(#{chartBean.numbersString}); // ROWS from backing bean JSF

        var options = {
          chart: {
            title: 'Box Office Earnings in First Two Weeks of Opening',
            subtitle: 'in millions of dollars (USD)'
          },
          width: 900,
          height: 500       
        };
         
        var chart_div = document.getElementById('chart-div');
        var chart = new google.charts.Line(chart_div);
        
        //DRAW CHART
        chart.draw(data, google.charts.Line.convertOptions(options));   
           
       
        google.visualization.events.addListener(chart, 'ready', function() {
            
        	 var canvas;
             var domURL;
             var imageNode;
             var imageURI;
             var svgParent;

            // add svg namespace to chart
            svgParent = chart.getContainer().getElementsByTagName('svg')[0];
            svgParent.setAttribute('xmlns', 'http://www.w3.org/2000/svg');

            // create image URI
            domURL = window.URL || window.webkitURL || window;
            imageNode = chart.getContainer().cloneNode(true);
            imageURI = domURL.createObjectURL(new Blob([svgParent.outerHTML], {type: 'image/svg+xml'}));
            image = new Image();
            image.onload = function() {
              canvas = document.createElement('canvas');
              canvas.setAttribute('width', parseFloat(svgParent.getAttribute('width')));
              canvas.setAttribute('height', parseFloat(svgParent.getAttribute('height')));
              canvas.getContext('2d').drawImage(image, 0, 0);
                         
              //Link to Download Image
              var download = document.getElementById('download-link');
              download.href = canvas.toDataURL('image/png');
              download.download = 'chart.png';
              
            }
            
            image.src = imageURI;              
                      
        });                
                      
      }
      
 </script>
 
    <div class="chart-wrapper" >
    
    <span id="btn-chart-close"><i class="fas fa-times"></i></span>

    <!--Div that will hold the pie chart-->
    <div id="chart-div"></div>     
       
      
     <a class="text-decoration-none" id="download-link">
      <span id="btn-chart-download"> 
    <i class="fas fa-download chart-icon"></i>  
    </span> 
     </a>  
          
    </div>  
     
    </ui:define>
   </ui:composition>