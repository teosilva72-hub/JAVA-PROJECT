<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:cc="http://xmlns.jcp.org/jsf/composite"
	xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
	xmlns:jsf="http://xmlns.jcp.org/jsf" 
	xmlns:pf="http://primefaces.org/ui"
	template="/pages/main/template/dashboard-rov-layout.xhtml">
	
	<f:metadata>
	
	 <!-- Create Table Header -->
	<f:viewAction action="#{mtoReportsBean.CreateFields(1)}" /> 
	        
    </f:metadata>
	
	<ui:define name="head" >
	
	<h:outputStylesheet library="css/datatables/custom" name="table-style.css" />	
	<h:outputStylesheet library="css/reports" name="reports_template.css"  /> 	

<script>

/*<![CDATA[ */
	
	$(document).ready(function(){	
	
function toDate(dateStr) {
	  var parts = dateStr.split("/")
	  return new Date(parts[2], parts[1] - 1, parts[0])
	}

jQuery.validator.addMethod("maxDate", function (value, element) {
    var max = 45;
    var startDate =  $('#dateStart').val();
    var endDate =  $('#dateEnd').val();
        
    var dataInicio = toDate(startDate);
    var dataFim = toDate(endDate);
               
    var days = (dataFim - dataInicio) / (1000*3600*24);
    
    if (days > max){
    	
    	 $('#dateEnd').removeClass('valid').addClass('invalid');
    	 $('#dateEnd-error').parent().find('.error').fadeIn(500);
    	 return false;
    }
    else{  $('#dateEnd').removeClass('invalid').addClass('valid'); return true;      
    }
}, "#{validatorMessages.validator_max_date}");

jQuery.validator.addMethod("greaterThanStartDate", 
		function(value, element, params) {

		    if (!/Invalid|NaN/.test(new Date(value))) {
		    	 $('#dateEnd').removeClass('valid').addClass('invalid');
		    	 $('#dateEnd-error').parent().find('.error').fadeIn(500);
		        return new Date(value) >= new Date($(params).val());
		    }
		    
		    else {
		    	$('#dateEnd').removeClass('invalid').addClass('valid');
		    return isNaN(value) && isNaN($(params).val()) 
		        || (Number(value) >= Number($(params).val())); 
		    
            }
		    
		},"#{validatorMessages.validator_start_date_greater_than_end_date_header}");


    //form validation rules
    $("#form_myModal").validate({    	
        rules: {
            equips:{
              required:true
            }, 
            periods:{
              required: true
            },
            vehicles:{
            	required: true
            },
            dateStart:{
               required: true,
               dateITA: true
            },
            dateEnd: {
              required: true,
              greaterThanStartDate: "#dateStart",
              dateITA: true,
              maxDate: true
            }
              
          },
        messages: {
            equips:{
            	required: "#{requiredMessages.required_sat_reports_select_equipments}"
             },
            periods:{ required: "#{requiredMessages.required_sat_reports_select_periods}" },
            vehicles:{ required: "#{requiredMessages.required_sat_reports_select_vehicles}"}, 
            dateStart:{
            	required: "#{requiredMessages.required_sat_reports_input_date_start }",
            	dateITA:  "#{validatorMessages.validator_valid_date}"
            	
            },
            dateEnd:{ required: "#{requiredMessages.required_sat_reports_input_date_start}",            	      
            	      dateITA: "#{validatorMessages.validator_valid_date}"
             }
          },
          errorClass : "error",
          // use highlight and unhighlight
          highlight: function(element, errorClass) {
           $(element).addClass(errorClass);
           $(element.form).find("label[for=" + element.id + "]").addClass(errorClass);
           $(element.form).find("select").addClass('invalid');
           $(element.form).find("input").addClass('invalid');
           },
          unhighlight: function(element, errorClass) {
           $(element).removeClass(errorClass);
           $(element.form).find("label[for=" + element.id + "]").removeClass(errorClass);
           $(element.form).find("select").removeClass('invalid');
           $(element.form).find("input").removeClass('invalid');
           
          } 	    
      });    
   });
       
    /* ]]> */
    
</script> 

	</ui:define>
	
	 <ui:define name="main-content" >
	 
	  <div class="table-container">
	 
	  <h:dataTable id="weather-year-table" value="#{mtoReportsBean.resultList}" var="weather" autocomplete="off"				               
     styleClass="table table-striped table-bordered table-dark custom-table" cellspacing="0" width="100%" 
     headerClass="custom-table-header">	
                   
     <c:forEach items="#{mtoReportsBean.columns}" var="header" varStatus="loop">
          <h:column>
              <f:facet name ="header">#{header.field}</f:facet>
              <h:outputText value="#{weather[header.value]}" />
            </h:column> 
     </c:forEach>   
  	 	 
    </h:dataTable>
    
    <!-- Button FORM -->
    
       <h:form id="form-btns">
			<div id="buttons" >
			<div id="btn-search-tab" class="text-center">
           <h:commandButton id="btn-tab-search" class="btn btn-dark panel-button" 
             value="#{mtoLabels.mto_reports_btn_search}">
           <f:passThroughAttribute name="data-toggle" value="modal" />
           <f:passThroughAttribute name="data-target" value="#modalReportOption" />           
           <f:ajax execute="@form" render="@none" />
           </h:commandButton>
            </div>		 
							     
			<div id="btn-clean-tab">				
			<h:commandButton value="#{mtoLabels.mto_reports_btn_clean}" id="btn-tab-reset"
				class="btn btn-dark panel-button" onclick="resetTable();">	
				<f:ajax execute="@form" render="@form" />
				 </h:commandButton>	   		   	
		   </div>		   
		   </div>
		 </h:form>		 
		 </div>	
		 
		  <h:form id="excelForm">		 
		 <h:commandLink ajax="false" immediate="true"
					action="#{mtoReportsBean.download}" widgetVar="startLink">
					  <h:graphicImage
					    url="/resources/icons/microsoft/microsoft_excel_logo.png"
						styleClass="ui-image-icon-download" /> 								
		 </h:commandLink>		 
		 </h:form> 
	 	 
	<!-- myModal -->
   <div class="modal fade" id="modalReportOption" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <h:form class="modal-content" name="form_myModal" id="form_myModal">
             <div class="modal-header text-center">
             <h4 class="modal-title w-100 font-weight-bold">#{mtoLabels.mto_reports_modal_title}</h4>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
             </button>              
            </div>
            <div class="modal-body">    
                 <br/>
						<div class="contentGroupReports">
							<div class="select-field">								
							    <span><i class="fas fa-hdd"></i></span>								    					    
							      <select name="equip" id="equip">	
							       <option value="" >#{mtoLabels.mto_reports_select_station}</option>						      
								   	 <ui:repeat var="eqp"  value="#{mtoReportsBean.equipments}"  varStatus="eqpStatus" >
								         <option value="#{eqp.value}" > #{eqp.label} </option>	                                  
                                        </ui:repeat> 
                                   </select>										    							   														
							</div>
							<div class="error-label"><label for="equips" class="error" id="equips-error"></label></div>
						</div>
					
						<div class="contentGroupReports">
								<div class="select-field">									
									<span><i class="fas fa-calendar"></i></span>
									<select name="year" id="year" size="1"  >										
								     <option value="" >#{mtoLabels.mto_reports_select_year}</option>
								   	   <ui:repeat var="year"  value="#{mtoReportsBean.years}"  varStatus="yearStatus" >
								         <option value="#{year.value}" > #{year.label} </option>	                                  
                                        </ui:repeat> 									
								    </select>																	
								</div>
								<div class="error-label"><label for="years" class="error" id="years-error"></label></div>
							</div>
							
							<div class="contentGroupReports">
								<div class="select-field">									
							      <span><i class="fas fa-calendar-alt"></i></span>
									<select name="start-month" id="start-month" size="1"  >										
								     <option value="" >#{mtoLabels.mto_reports_select_start_month}</option>
								   	   <ui:repeat var="mth"  value="#{mtoReportsBean.months}"  varStatus="startStatus" >
								         <option value="#{mth.value}" > #{mth.label} </option>	                                  
                                        </ui:repeat> 									
								    </select>																	
								</div>
								<div class="error-label"><label for="start-month" class="error" id="start-month-error"></label></div>
							</div>
													
							<div class="contentGroupReports">
								<div class="select-field">									
							      <span><i class="fas fa-calendar-alt"></i></span>
									<select name="end-month" id="end-month" size="1"  >										
								     <option value="" >#{mtoLabels.mto_reports_select_end_month}</option>
								   	   <ui:repeat var="mth2"  value="#{mtoReportsBean.months}"  varStatus="endStatus" >
								         <option value="#{mth2.value}" > #{mth2.label} </option>	                                  
                                        </ui:repeat> 									
								    </select>																	
								</div>
								<div class="error-label"><label for="end-month" class="error" id="end-month-error"></label></div>
							</div>																					
                
                 <input type="hidden" name="period" value="year" />	 
                 
			     </div>
              <div class="modal-footer">                
                  <h:commandButton value = "ENVIAR!" action="#{mtoReportsBean.GetReports(1)}"  class="btn btn-dark" />                
                <h:commandButton value = "LIMPAR!" action="#{mtoReportsBean.GetReports(1)}"  class="btn btn-dark" />              
             </div>
        </h:form>
    </div>
</div>
	 
</ui:define>

<ui:define name="jscript">
      <h:outputScript name="mto_reports_dataTable.js" library="js/reports" />	
	</ui:define>
	
		
</ui:composition>	